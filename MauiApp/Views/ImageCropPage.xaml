<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp.Views.ImageCropPage"
             BackgroundColor="Black">

    <Grid>
        <!-- Image to crop -->
        <Image x:Name="CropImage"
               Aspect="AspectFit"
               HorizontalOptions="FillAndExpand"
               VerticalOptions="FillAndExpand" />

        <!-- Overlay with crop handles -->
        <AbsoluteLayout x:Name="CropOverlay"
                        HorizontalOptions="FillAndExpand"
                        VerticalOptions="FillAndExpand">

            <!-- Crop Rectangle -->
            <Border x:Name="CropRectangle"
                    BackgroundColor="#40FFFFFF"
                    Stroke="{StaticResource PrimaryRed}"
                    StrokeThickness="2"
                    AbsoluteLayout.LayoutBounds="50,50,250,350"
                    AbsoluteLayout.LayoutFlags="None" />

            <!-- Top Left Handle -->
            <Frame x:Name="TopLeftHandle"
                   BackgroundColor="{StaticResource PrimaryRed}"
                   CornerRadius="15"
                   WidthRequest="30"
                   HeightRequest="30"
                   HasShadow="False"
                   AbsoluteLayout.LayoutBounds="35,35,30,30"
                   AbsoluteLayout.LayoutFlags="None">
                <Frame.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnHandlePanUpdated" />
                </Frame.GestureRecognizers>
            </Frame>

            <!-- Top Right Handle -->
            <Frame x:Name="TopRightHandle"
                   BackgroundColor="{StaticResource PrimaryRed}"
                   CornerRadius="15"
                   WidthRequest="30"
                   HeightRequest="30"
                   HasShadow="False"
                   AbsoluteLayout.LayoutBounds="300,35,30,30"
                   AbsoluteLayout.LayoutFlags="None">
                <Frame.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnHandlePanUpdated" />
                </Frame.GestureRecognizers>
            </Frame>

            <!-- Bottom Left Handle -->
            <Frame x:Name="BottomLeftHandle"
                   BackgroundColor="{StaticResource PrimaryRed}"
                   CornerRadius="15"
                   WidthRequest="30"
                   HeightRequest="30"
                   HasShadow="False"
                   AbsoluteLayout.LayoutBounds="35,400,30,30"
                   AbsoluteLayout.LayoutFlags="None">
                <Frame.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnHandlePanUpdated" />
                </Frame.GestureRecognizers>
            </Frame>

            <!-- Bottom Right Handle -->
            <Frame x:Name="BottomRightHandle"
                   BackgroundColor="{StaticResource PrimaryRed}"
                   CornerRadius="15"
                   WidthRequest="30"
                   HeightRequest="30"
                   HasShadow="False"
                   AbsoluteLayout.LayoutBounds="300,400,30,30"
                   AbsoluteLayout.LayoutFlags="None">
                <Frame.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnHandlePanUpdated" />
                </Frame.GestureRecognizers>
            </Frame>

        </AbsoluteLayout>

        <!-- Confirm Button -->
        <Button Text="Crop"
                BackgroundColor="{StaticResource PrimaryRed}"
                TextColor="White"
                HorizontalOptions="Center"
                VerticalOptions="End"
                Margin="0,0,0,40"
                Clicked="OnCropClicked"/>
    </Grid>
</ContentPage>